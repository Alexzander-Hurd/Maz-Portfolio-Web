---
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import ArtPiece from "../../components/ArtPiece.astro";
import { getCollection } from "astro:content";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

// Load and sort projects
const projects = (await getCollection("work")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Create columns with balanced distribution
let columns;
if (projects.length < 3) {
  columns = projects.length;
} else {
  columns = 3;
}
const colClass =
  columns === 3
    ? "col-lg-4 col-md-6 col-12"
    : columns === 2
      ? "col-md-6 col-12"
      : "col-12";
const cols = Array.from({ length: columns }, () => []);
const heights = Array.from({ length: columns }, () => 0);

// Simple balancing algorithm using image aspect ratio (or fallback)
projects.forEach((project) => {
  const image = project.data.images?.[0];
  const aspectRatio =
    image?.height && image?.width ? image.height / image.width : 1;
  const idx = heights.indexOf(Math.min(...heights));
  cols[idx].push(project);
  heights[idx] += aspectRatio;
});
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />

    <main class="container my-5">
      <!-- Metadata warning banner (Bootstrap 5) -->
      <div class="container-fluid">
        <div
          class="alert alert-warning d-flex align-items-center justify-content-between mb-0 rowcol"
          role="alert"
          aria-live="polite"
        >
          <div class="col-lg-1">
            <div class="d-flex align-items-center row">
              <svg
                class="bi flex-shrink-0 me-2"
                width="24"
                height="24"
                role="img"
                aria-hidden="true"
                focusable="false"
              >
                <use xlink:href="#exclamation-triangle-fill"></use>
              </svg>
            </div>
          </div>
          <div class="col-lg-9">
            <div class="d-flex align-items-centre ms-3 row">
              <div>
                <strong>Under Construction:</strong>
                This page is currently under construction and is not live yet. Content
                will be added soon
              </div>
            </div>

            <div class="d-flex align-items-center ms-3 row">
              <small class="me-3 text-muted">Thank you for your patience</small>
            </div>
          </div>
          <div class="d-flex align-items-center ms-3 col-lg-2">
            <button
              type="button"
              class="btn btn-sm btn-outline-dark"
              data-bs-dismiss="alert"
              aria-label="Dismiss"
            >
              Dismiss
            </button>
          </div>
        </div>
      </div>

      <!-- Optional: add the SVG symbol in your page (place once, e.g. in the document <body> or a central include) -->
      <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol
          id="exclamation-triangle-fill"
          viewBox="0 0 16 16"
          fill="currentColor"
        >
          <path
            d="M8.982 1.566a1.13 1.13 0 0 0-1.964 0L.165 13.233c-.457.778.091 1.767.982 1.767h13.706c.89 0 1.438-.99.982-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1-2.002 0 1 1 0 0 1 2.002 0z"
          ></path>
        </symbol>
      </svg>
      <div class="row">
        {
          cols.map((col, colIdx) => (
            <div class={colClass} key={colIdx}>
              {col.map((project) => (
                <ArtPiece
                  title={project.data.title}
                  date={project.data.pubDate}
                  description={project.data.description}
                  image={project.data.images[0]}
                  colour="#facbe0"
                  link={`/work/${project.id}/`}
                />
              ))}
            </div>
          ))
        }
      </div>

      <Footer />
      <script src="../../scripts/artinfo.js"></script>
    </main>
  </body>
</html>
